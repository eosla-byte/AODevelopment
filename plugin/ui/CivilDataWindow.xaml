<Window x:Class="RevitCivilConnector.UI.CivilDataWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="CivilData 2.0" Height="600" Width="800" WindowStartupLocation="CenterScreen" ResizeMode="CanResize">
    <Window.Resources>
        <Style TargetType="Button">
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="5"/>
        </Style>
    </Window.Resources>
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="*"/>    <!-- Content -->
            <RowDefinition Height="Auto"/> <!-- Footer Navigation -->
        </Grid.RowDefinitions>

        <!-- HEADER -->
        <Border Grid.Row="0" BorderBrush="#DDDDDD" BorderThickness="0,0,0,1" Padding="0,0,0,10" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal">
                <Image Width="32" Height="32" Source="/RevitCivilConnector;component/Resources/icono1.png" Margin="0,0,10,0"/>
                <StackPanel>
                    <TextBlock Text="CivilData 2.0" FontSize="18" FontWeight="Bold" Foreground="#333"/>
                    <TextBlock x:Name="txtStepTitle" Text="Step 1: Link Data" FontSize="12" Foreground="#666"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- VIEW 1: LOAD (Start) -->
        <Grid x:Name="ViewLoad" Grid.Row="1" Visibility="Visible">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Width="500">
                <TextBlock Text="Import LandXML Data" FontSize="16" Margin="0,0,0,20" HorizontalAlignment="Center"/>
                
                <Grid Margin="0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Path:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <TextBox x:Name="txtFilePath" Grid.Column="1" Height="25" VerticalContentAlignment="Center"/>
                    <Button x:Name="btnBrowse" Content="Browse" Grid.Column="2" Click="BtnBrowse_Click"/>
                </Grid>

                <Grid Margin="0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Visible Elements:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <ComboBox x:Name="cmbVisibleFilter" Grid.Column="1" Height="25" SelectedIndex="0">
                        <ComboBoxItem Content="All Elements From File"/>
                        <ComboBoxItem Content="Custom Selection..."/>
                    </ComboBox>
                    <Button Content="..." Grid.Column="2" Width="30" Click="BtnFilter_Click"/>
                </Grid>
                
                <GroupBox Header="Coordinate system basis" Margin="0,20,0,0" Padding="10">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <RadioButton x:Name="rbShared" Content="Shared Coordinates" IsChecked="True" Margin="0,0,20,0"/>
                        <RadioButton x:Name="rbInternal" Content="Project Internal"/>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </Grid>

        <!-- VIEW 2: SELECTION -->
        <Grid x:Name="ViewSelection" Grid.Row="1" Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <Grid Grid.Row="0" Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="Select Elements to Import" FontWeight="Bold"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="Check all" Click="BtnCheckAll_Click" Padding="5,2"/>
                    <Button Content="Check none" Click="BtnCheckNone_Click" Padding="5,2"/>
                </StackPanel>
            </Grid>

            <DataGrid x:Name="dgElements" Grid.Row="1" AutoGenerateColumns="False" CanUserAddRows="False">
                <DataGrid.Columns>
                    <DataGridCheckBoxColumn Header="Import" Binding="{Binding IsSelected}" Width="50"/>
                    <DataGridTextColumn Header="Element Name" Binding="{Binding Name}" Width="*" IsReadOnly="True"/>
                    <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="100" IsReadOnly="True"/>
                    <DataGridTemplateColumn Header="Material" Width="150">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ComboBox ItemsSource="{Binding AvailableMaterials}" SelectedItem="{Binding MaterialName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>

        <!-- VIEW 3: MANAGER (Preview) -->
        <Grid x:Name="ViewManager" Grid.Row="1" Visibility="Collapsed">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel: Hierarchy & Tools -->
            <Border BorderBrush="#CCC" BorderThickness="0,0,1,0" Padding="0,0,5,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/> <!-- Header info if needed -->
                        <RowDefinition Height="*"/>    <!-- Tree/List -->
                        <RowDefinition Height="Auto"/> <!-- Toolbar -->
                        <RowDefinition Height="Auto"/> <!-- Add Button -->
                    </Grid.RowDefinitions>

                    <!-- Tree View of Imported Data -->
                    <TreeView x:Name="tvImportedData" Grid.Row="1" BorderThickness="0">
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                <StackPanel Orientation="Vertical" Margin="2">
                                    <StackPanel Orientation="Horizontal">
                                        <!-- Icon placeholder -->
                                        <TextBlock Text="â–¼" FontSize="8" Margin="0,2,5,0" Visibility="{Binding HasChildren, Converter={StaticResource BoolToVis}}"/>
                                        <TextBlock Text="{Binding Name}" FontWeight="Bold"/>
                                    </StackPanel>
                                    <TextBlock Text="{Binding InfoText}" FontSize="10" Foreground="Gray" Margin="10,0,0,0"/>
                                    <TextBlock Text="{Binding Comment, StringFormat='Comment: {0}'}" FontSize="10" Foreground="Gray" Margin="10,0,0,0" FontStyle="Italic"/>
                                </StackPanel>
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>
                    </TreeView>
                    
                    <!-- Toolbar (5 Buttons) -->
                    <Border Grid.Row="2" BorderBrush="#EEE" BorderThickness="0,1,0,0" Padding="0,5">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                            <Button x:Name="btnToolRefresh" Width="30" Height="25" Click="BtnRefresh_Click" ToolTip="Refresh Data">
                                <TextBlock Text="âŸ³" FontSize="14"/>
                            </Button>
                            <Button x:Name="btnToolMaterial" Width="30" Height="25" Click="BtnMaterial_Click" ToolTip="Change Material">
                                <TextBlock Text="M" FontWeight="Bold"/>
                            </Button>
                            <Button x:Name="btnToolRename" Width="30" Height="25" Click="BtnRename_Click" ToolTip="Rename">
                                <TextBlock Text="A|" FontSize="10"/>
                            </Button>
                            <Button x:Name="btnToolDelete" Width="30" Height="25" Click="BtnDelete_Click" ToolTip="Delete" Foreground="Red">
                                <TextBlock Text="âœ•"/>
                            </Button>
                            <Button x:Name="btnToolExplode" Width="30" Height="25" Click="BtnExplode_Click" ToolTip="Explode">
                                <TextBlock Text="ðŸ’¥"/>
                            </Button>
                        </StackPanel>
                    </Border>
                    
                    <Button Grid.Row="3" Content="Add More Civil Data ..." Click="BtnAddMore_Click" Height="25" Margin="0,5,0,0"/>
                </Grid>
            </Border>

            <!-- Right Panel: Preview -->
            <Grid Grid.Column="1" Margin="10,0,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/> <!-- Footer Controls -->
                </Grid.RowDefinitions>
                
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,5">
                    <TextBlock Text="Display Style:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <ComboBox x:Name="cmbDisplayStyle" SelectedIndex="0" Width="100">
                        <ComboBoxItem Content="Shaded"/>
                        <ComboBoxItem Content="Wireframe"/>
                        <ComboBoxItem Content="Realistic"/>
                    </ComboBox>
                </StackPanel>

                <Border Grid.Row="1" BorderBrush="#999" BorderThickness="1" Background="#FAFAFA">
                    <Grid>
                        <!-- Placeholder for 3D View -->
                        <Canvas x:Name="cvsPreview" Background="Transparent" ClipToBounds="True">
                             <TextBlock Text="3D Visualization" Canvas.Left="10" Canvas.Top="10" Foreground="#AAA"/>
                        </Canvas>
                        <TextBlock Text="Preview Active" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="#DDD" FontSize="20" FontWeight="Bold" RenderTransformOrigin="0.5,0.5">
                            <TextBlock.RenderTransform>
                                <RotateTransform Angle="-45"/>
                            </TextBlock.RenderTransform>
                        </TextBlock>
                    </Grid>
                </Border>
                
                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,5,0,0">
                     <TextBlock Text="Saved Path:" VerticalAlignment="Center" Foreground="Gray" Margin="0,0,5,0"/>
                     <TextBox x:Name="txtSavedPath" IsReadOnly="True" Width="250" VerticalAlignment="Center" Background="#F0F0F0"/>
                </StackPanel>
            </Grid>
        </Grid>


        <!-- FOOTER: NAVIGATION -->
        <Grid Grid.Row="2" Margin="0,10,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBlock x:Name="txtStatus" Text="Ready" VerticalAlignment="Center" Foreground="#888"/>

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button x:Name="btnCancel" Content="Cancel" Click="BtnCancel_Click" Width="80"/>
                
                <Button x:Name="btnBack" Content="&lt; Back" Click="BtnBack_Click" Width="80" Visibility="Collapsed"/>
                <Button x:Name="btnNext" Content="Next &gt;" Click="BtnNext_Click" Width="80"/>
                <Button x:Name="btnFinish" Content="Finish" Click="BtnFinish_Click" Width="80" Visibility="Collapsed" Background="#007ACC" Foreground="White" FontWeight="Bold"/>
                
                <!-- Manager Buttons (Only View 3) -->
                <StackPanel x:Name="pnlManagerButtons" Orientation="Horizontal" Visibility="Collapsed">
                     <Button Content="Ok" Click="BtnOk_Click" Width="80" FontWeight="Bold"/>
                </StackPanel>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
